<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>對展晟的印象</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Microsoft JhengHei", sans-serif;
        background-color: #ffffe2;
        color: #4d1f00;
        line-height: 1.6;
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 600px;
        margin: 0 auto;
        background-color: #ffffe2;
      }

      .page {
        display: none;
        animation: fadeIn 0.3s ease-in;
      }

      .page.active {
        display: block;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      h1 {
        text-align: center;
        margin-bottom: 30px;
        font-size: 28px;
        font-weight: bold;
      }

      h2 {
        text-align: center;
        margin-bottom: 30px;
        font-size: 24px;
        font-weight: bold;
      }

      .form-group {
        margin-bottom: 25px;
      }

      label {
        display: block;
        margin-bottom: 10px;
        font-weight: bold;
        font-size: 16px;
      }

      input[type="text"],
      input[type="email"],
      input[type="password"],
      textarea {
        width: 100%;
        padding: 15px;
        background-color: #fffff1;
        border: 2px solid #4d1f00;
        border-radius: 8px;
        font-family: "Microsoft JhengHei", sans-serif;
        font-size: 16px;
        color: #4d1f00;
        resize: vertical;
        min-height: 50px;
      }

      textarea {
        min-height: 80px;
      }

      input[type="text"]:focus,
      input[type="email"]:focus,
      input[type="password"]:focus,
      textarea:focus {
        outline: none;
        border-color: #6d2f10;
        box-shadow: 0 0 5px rgba(77, 31, 0, 0.3);
      }

      button {
        background-color: #4d1f00;
        color: #ffffe2;
        border: none;
        padding: 15px 30px;
        border-radius: 8px;
        font-family: "Microsoft JhengHei", sans-serif;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        width: 100%;
        margin-top: 20px;
        transition: background-color 0.3s;
      }

      button:hover {
        background-color: #6d2f10;
      }

      button:disabled {
        background-color: #999;
        cursor: not-allowed;
      }

      .admin-btn {
        width: auto;
        margin: 10px 5px;
        display: inline-block;
      }

      .response-card {
        background-color: #fffff1;
        border: 2px solid #4d1f00;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        position: relative;
      }

      .response-header {
        font-weight: bold;
        font-size: 18px;
        margin-bottom: 15px;
        text-align: center;
        border-bottom: 1px solid #4d1f00;
        padding-bottom: 10px;
      }

      .response-item {
        margin-bottom: 15px;
      }

      .response-question {
        font-weight: bold;
        margin-bottom: 5px;
      }

      .response-answer {
        background-color: #ffffe2;
        padding: 10px;
        border-radius: 4px;
        border-left: 3px solid #4d1f00;
      }

      .delete-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        background-color: #d32f2f;
        color: white;
        border: none;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        min-width: 30px;
        min-height: 30px;
        cursor: pointer;
        font-size: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0;
        line-height: 1;
      }

      .delete-btn:hover {
        background-color: #b71c1c;
      }

      .success-message {
        text-align: center;
        font-size: 18px;
        font-weight: bold;
        margin: 30px 0;
        padding: 20px;
        background-color: #fffff1;
        border: 2px solid #4d1f00;
        border-radius: 8px;
      }

      .admin-controls {
        text-align: center;
        margin-bottom: 30px;
      }

      .filter-controls {
        text-align: center;
        margin-bottom: 20px;
        padding: 15px;
        background-color: #fffff1;
        border-radius: 8px;
        border: 1px solid #4d1f00;
      }

      .filter-input {
        display: inline-block;
        width: auto;
        margin: 0 10px;
        padding: 8px 12px;
        font-size: 14px;
      }

      .no-responses {
        text-align: center;
        font-style: italic;
        color: #6d2f10;
        margin: 30px 0;
      }

      .loading {
        text-align: center;
        color: #6d2f10;
        margin: 20px 0;
      }

      .error-message {
        text-align: center;
        color: #d32f2f;
        background-color: #ffebee;
        border: 1px solid #d32f2f;
        padding: 10px;
        border-radius: 4px;
        margin-bottom: 20px;
      }

      .connection-status {
        position: fixed;
        top: 10px;
        right: 10px;
        padding: 5px 10px;
        border-radius: 15px;
        font-size: 12px;
        font-weight: bold;
      }

      .online {
        background-color: #4caf50;
        color: white;
      }

      .offline {
        background-color: #f44336;
        color: white;
      }

      .user-info {
        text-align: right;
        margin-bottom: 20px;
        padding: 10px;
        background-color: #fffff1;
        border-radius: 8px;
        border: 1px solid #4d1f00;
      }

      .logout-btn {
        background-color: #d32f2f;
        width: auto;
        padding: 8px 16px;
        font-size: 14px;
        margin: 0 0 0 10px;
      }

      .logout-btn:hover {
        background-color: #b71c1c;
      }

      .stats-info {
        text-align: center;
        margin-bottom: 20px;
        padding: 15px;
        background-color: #fffff1;
        border-radius: 8px;
        border: 1px solid #4d1f00;
        font-weight: bold;
      }

      .pagination {
        text-align: center;
        margin: 20px 0;
      }

      .pagination button {
        width: auto;
        margin: 0 5px;
        padding: 8px 16px;
        font-size: 14px;
      }

      @media (max-width: 480px) {
        .container {
          padding: 10px;
        }

        h1 {
          font-size: 24px;
        }

        h2 {
          font-size: 20px;
        }

        .admin-btn {
          width: 100%;
          margin: 5px 0;
        }

        .filter-input {
          width: 100%;
          margin: 5px 0;
        }
      }
    </style>
  </head>
  <body>
    <div class="connection-status" id="connectionStatus">離線</div>

    <div class="container">
      <!-- 設定暱稱頁面 -->
      <div id="nickname-page" class="page active">
        <h1>對展晟的印象</h1>
        <div class="form-group">
          <label for="nickname">請輸入您的暱稱：</label>
          <input
            type="text"
            id="nickname"
            placeholder="請輸入暱稱"
            maxlength="20"
          />
        </div>
        <button onclick="setNickname()">開始填寫</button>
      </div>

      <!-- 問卷頁面 -->
      <div id="questionnaire-page" class="page">
        <form id="questionnaire-form">
          <div class="form-group">
            <label for="firstImpression"
              >1. 請寫下您加入展晟前，對展晟的第一印象？</label
            >
            <textarea
              id="firstImpression"
              placeholder="請描述對展晟的第一印象..."
              required
            ></textarea>
          </div>

          <div class="form-group">
            <label for="memorableExperience"
              >2. 請寫下您加入展晟後，讓您印象最深刻的人或事物？</label
            >
            <textarea
              id="memorableExperience"
              placeholder="請描述讓您印象最深刻的人或事物..."
              required
            ></textarea>
          </div>

          <button type="submit" id="submitBtn">提交答案</button>
        </form>
      </div>

      <!-- 填答完成頁面 -->
      <div id="success-page" class="page">
        <div class="success-message">
          <h2>填答完成！</h2>
          <p>感謝您填寫對展晟的印象</p>
        </div>
        <button onclick="resetForm()">重新填寫</button>
      </div>

      <!-- 管理員登入頁面 -->
      <div id="admin-login-page" class="page">
        <h2>管理員登入</h2>
        <div id="login-error" class="error-message" style="display: none"></div>
        <form id="admin-login-form">
          <div class="form-group">
            <label for="admin-email">電子郵件：</label>
            <input
              type="email"
              id="admin-email"
              placeholder="請輸入管理員電子郵件"
              required
            />
          </div>
          <div class="form-group">
            <label for="admin-password">密碼：</label>
            <input
              type="password"
              id="admin-password"
              placeholder="請輸入密碼"
              required
            />
          </div>
          <button type="submit" id="loginBtn">登入</button>
          <button
            type="button"
            onclick="backToHome()"
            style="background-color: #666"
          >
            返回首頁
          </button>
        </form>
      </div>

      <!-- 管理員頁面 -->
      <div id="admin-page" class="page">
        <div class="user-info">
          <span>歡迎，<span id="admin-email-display"></span></span>
          <button class="logout-btn" onclick="adminLogout()">登出</button>
        </div>
        <h2>管理員控制台</h2>

        <div class="stats-info" id="stats-info">載入統計中...</div>

        <div class="admin-controls">
          <button class="admin-btn" onclick="refreshResponses()">
            重新整理
          </button>
          <button class="admin-btn" onclick="exportData()">匯出資料</button>
          <button class="admin-btn" onclick="clearAllResponses()">
            清除所有回答
          </button>
        </div>

        <div class="filter-controls">
          <input
            type="text"
            id="search-nickname"
            class="filter-input"
            placeholder="搜尋暱稱..."
            onkeyup="filterResponses()"
          />
          <input
            type="date"
            id="filter-date"
            class="filter-input"
            onchange="filterResponses()"
          />
          <button class="admin-btn" onclick="clearFilters()">清除篩選</button>
        </div>

        <div class="pagination" id="pagination-controls" style="display: none">
          <button onclick="changePage(-1)">上一頁</button>
          <span id="page-info"></span>
          <button onclick="changePage(1)">下一頁</button>
        </div>

        <div id="responses-container">
          <div class="loading">正在載入資料...</div>
        </div>
      </div>
    </div>

    <!-- Firebase SDK v9 -->
    <script type="module">
      // Import Firebase modules
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
      import {
        getAuth,
        signInWithEmailAndPassword,
        signOut,
        onAuthStateChanged,
      } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
      import {
        getFirestore,
        collection,
        addDoc,
        getDocs,
        deleteDoc,
        doc,
        onSnapshot,
        query,
        orderBy,
        limit,
        startAfter,
        where,
        Timestamp,
      } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

      // Firebase 配置
      const firebaseConfig = {
        apiKey: "AIzaSyCUdr26vPWGbWMtCTFo-ocHW1vgcj-AxGE",
        authDomain: "new-76f65.firebaseapp.com",
        projectId: "new-76f65",
        storageBucket: "new-76f65.firebasestorage.app",
        messagingSenderId: "404841788745",
        appId: "1:404841788745:web:7a8de1e77a9cddfc8f5698",
      };

      // 初始化 Firebase
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);

      // 全局變量
      let currentNickname = "";
      let currentUser = null;
      let allResponses = [];
      let filteredResponses = [];
      let currentPage = 1;
      const responsesPerPage = 10;
      let unsubscribeResponses = null;

      // 將函數暴露到全局作用域
      window.setNickname = setNickname;
      window.showAdmin = showAdmin;
      window.backToHome = backToHome;
      window.resetForm = resetForm;
      window.refreshResponses = refreshResponses;
      window.clearAllResponses = clearAllResponses;
      window.exportData = exportData;
      window.adminLogout = adminLogout;
      window.filterResponses = filterResponses;
      window.clearFilters = clearFilters;
      window.changePage = changePage;
      window.deleteResponse = deleteResponse;

      function updateConnectionStatus(isOnline) {
        const status = document.getElementById("connectionStatus");
        if (isOnline) {
          status.textContent = "已連線";
          status.className = "connection-status online";
        } else {
          status.textContent = "離線";
          status.className = "connection-status offline";
        }
      }

      function showPage(pageId) {
        const pages = document.querySelectorAll(".page");
        pages.forEach((page) => page.classList.remove("active"));
        document.getElementById(pageId).classList.add("active");
      }

      function setNickname() {
        const nickname = document.getElementById("nickname").value.trim();
        if (!nickname) {
          alert("請輸入暱稱！");
          return;
        }
        currentNickname = nickname;
        showPage("questionnaire-page");
      }

      function showAdmin() {
        showPage("admin-login-page");
        document.getElementById("admin-email").value = "";
        document.getElementById("admin-password").value = "";
        document.getElementById("login-error").style.display = "none";
      }

      function backToHome() {
        if (unsubscribeResponses) {
          unsubscribeResponses();
          unsubscribeResponses = null;
        }
        showPage("nickname-page");
        document.getElementById("nickname").value = "";
        currentNickname = "";
      }

      function resetForm() {
        document.getElementById("questionnaire-form").reset();
        showPage("nickname-page");
        document.getElementById("nickname").value = "";
        currentNickname = "";
      }

      async function adminLogout() {
        try {
          await signOut(auth);
          currentUser = null;
          if (unsubscribeResponses) {
            unsubscribeResponses();
            unsubscribeResponses = null;
          }
          backToHome();
        } catch (error) {
          console.error("登出失敗:", error);
          alert("登出失敗，請稍後再試！");
        }
      }

      async function deleteResponse(responseId) {
        if (!currentUser) {
          alert("請先登入管理員帳號");
          return;
        }

        if (!confirm("確定要刪除這筆回答嗎？此操作無法復原。")) {
          return;
        }

        try {
          await deleteDoc(doc(db, "responses", responseId));
          console.log("✅ 回答已刪除");
        } catch (error) {
          console.error("刪除失敗:", error);
          alert("刪除失敗，請稍後再試！\n錯誤詳情：" + error.message);
        }
      }

      function filterResponses() {
        const searchNickname = document
          .getElementById("search-nickname")
          .value.toLowerCase()
          .trim();
        const filterDate = document.getElementById("filter-date").value;

        filteredResponses = allResponses.filter((response) => {
          let matchNickname = true;
          let matchDate = true;

          if (searchNickname) {
            matchNickname = response.nickname
              .toLowerCase()
              .includes(searchNickname);
          }

          if (filterDate) {
            const responseDate = new Date(response.timestamp.toDate())
              .toISOString()
              .split("T")[0];
            matchDate = responseDate === filterDate;
          }

          return matchNickname && matchDate;
        });

        currentPage = 1;
        displayCurrentPage();
      }

      function clearFilters() {
        document.getElementById("search-nickname").value = "";
        document.getElementById("filter-date").value = "";
        filteredResponses = [...allResponses];
        currentPage = 1;
        displayCurrentPage();
      }

      function changePage(direction) {
        const totalPages = Math.ceil(
          filteredResponses.length / responsesPerPage
        );
        const newPage = currentPage + direction;

        if (newPage >= 1 && newPage <= totalPages) {
          currentPage = newPage;
          displayCurrentPage();
        }
      }

      function displayCurrentPage() {
        const startIndex = (currentPage - 1) * responsesPerPage;
        const endIndex = startIndex + responsesPerPage;
        const pageResponses = filteredResponses.slice(startIndex, endIndex);

        displayResponses(pageResponses);
        updatePagination();
      }

      function updatePagination() {
        const totalPages = Math.ceil(
          filteredResponses.length / responsesPerPage
        );
        const paginationControls = document.getElementById(
          "pagination-controls"
        );
        const pageInfo = document.getElementById("page-info");

        if (totalPages > 1) {
          paginationControls.style.display = "block";
          pageInfo.textContent = `第 ${currentPage} 頁 / 共 ${totalPages} 頁`;
        } else {
          paginationControls.style.display = "none";
        }
      }

      async function exportData() {
        try {
          const responsesRef = collection(db, "responses");
          const q = query(responsesRef, orderBy("timestamp", "desc"));
          const querySnapshot = await getDocs(q);

          if (querySnapshot.empty) {
            alert("沒有資料可匯出");
            return;
          }

          // 轉換為 CSV 格式
          let csvContent = "\uFEFF"; // BOM for UTF-8
            csvContent += "暱稱,提交時間,加入前第一印象,印象深刻的人或事物\n";

          querySnapshot.forEach((doc) => {
            const response = doc.data();
            const timestamp = response.timestamp
              .toDate()
              .toLocaleString("zh-TW");
            const row = [
              response.nickname,
              timestamp,
              `"${response.answers.firstImpression.replace(/"/g, '""')}"`,
              `"${response.answers.memorableExperience.replace(/"/g, '""')}"`,
            ].join(",");
            csvContent += row + "\n";
          });

          // 下載文件
          const blob = new Blob([csvContent], {
            type: "text/csv;charset=utf-8;",
          });
          const link = document.createElement("a");
          const url = URL.createObjectURL(blob);
          link.setAttribute("href", url);
          link.setAttribute(
            "download",
            `資料_${new Date().toISOString().split("T")[0]}.csv`
          );
          link.style.visibility = "hidden";
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
        } catch (error) {
          console.error("匯出失敗:", error);
          alert("匯出失敗，請稍後再試！\n錯誤詳情：" + error.message);
        }
      }

      // 監聽認證狀態變化
      onAuthStateChanged(auth, (user) => {
        if (user) {
          currentUser = user;
          document.getElementById("admin-email-display").textContent =
            user.email;
          if (
            document
              .getElementById("admin-login-page")
              .classList.contains("active")
          ) {
            showPage("admin-page");
            loadResponses();
          }
          updateConnectionStatus(true);
        } else {
          currentUser = null;
          if (
            document.getElementById("admin-page").classList.contains("active")
          ) {
            backToHome();
          }
        }
      });

      // 管理員登入表單處理
      document
        .getElementById("admin-login-form")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const loginBtn = document.getElementById("loginBtn");
          const errorDiv = document.getElementById("login-error");

          loginBtn.disabled = true;
          loginBtn.textContent = "登入中...";
          errorDiv.style.display = "none";

          const email = document.getElementById("admin-email").value.trim();
          const password = document.getElementById("admin-password").value;

          try {
            await signInWithEmailAndPassword(auth, email, password);
            // 登入成功，onAuthStateChanged 會處理頁面切換
          } catch (error) {
            console.error("登入失敗:", error);
            let errorMessage = "登入失敗，請稍後再試！";

            switch (error.code) {
              case "auth/user-not-found":
                errorMessage = "找不到此帳號";
                break;
              case "auth/wrong-password":
                errorMessage = "密碼錯誤";
                break;
              case "auth/invalid-email":
                errorMessage = "電子郵件格式不正確";
                break;
              case "auth/user-disabled":
                errorMessage = "此帳號已被停用";
                break;
              case "auth/too-many-requests":
                errorMessage = "登入嘗試次數過多，請稍後再試";
                break;
              case "auth/invalid-credential":
                errorMessage = "帳號或密碼錯誤";
                break;
            }

            errorDiv.textContent = errorMessage;
            errorDiv.style.display = "block";
          } finally {
            loginBtn.disabled = false;
            loginBtn.textContent = "登入";
          }
        });

      // 問卷表單處理
      document
        .getElementById("questionnaire-form")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const submitBtn = document.getElementById("submitBtn");
          submitBtn.disabled = true;
          submitBtn.textContent = "提交中...";

          const firstImpression = document.getElementById("firstImpression").value.trim();
          const memorableExperience = document
            .getElementById("memorableExperience")
            .value.trim();

          if (!firstImpression || !memorableExperience) {
            alert("請完整填寫所有問題！");
            submitBtn.disabled = false;
            submitBtn.textContent = "提交答案";
            return;
          }

          try {
            const response = {
              nickname: currentNickname,
              timestamp: Timestamp.now(),
              answers: {
                firstImpression: firstImpression,
                memorableExperience: memorableExperience,
              },
            };

            await addDoc(collection(db, "responses"), response);

            console.log("✅ 答案已儲存至 Firestore:", response);
            showPage("success-page");
          } catch (error) {
            console.error("提交失敗:", error);
            alert("提交失敗，請稍後再試！\n錯誤詳情：" + error.message);
          } finally {
            submitBtn.disabled = false;
            submitBtn.textContent = "提交答案";
          }
        });

      function loadResponses() {
        const container = document.getElementById("responses-container");
        container.innerHTML = '<div class="loading">正在載入資料...</div>';

        try {
          const responsesRef = collection(db, "responses");
          const q = query(responsesRef, orderBy("timestamp", "desc"));

          unsubscribeResponses = onSnapshot(
            q,
            (querySnapshot) => {
              allResponses = [];
              querySnapshot.forEach((doc) => {
                allResponses.push({
                  id: doc.id,
                  ...doc.data(),
                });
              });

              filteredResponses = [...allResponses];
              currentPage = 1;
              updateStats();
              displayCurrentPage();
            },
            (error) => {
              console.error("載入資料失敗:", error);
              container.innerHTML =
                '<div class="no-responses">載入資料失敗，請重新整理頁面</div>';
            }
          );
        } catch (error) {
          console.error("設定監聽失敗:", error);
          container.innerHTML =
            '<div class="no-responses">設定資料監聽失敗</div>';
        }
      }

      function updateStats() {
        const statsInfo = document.getElementById("stats-info");
        const today = new Date();
        today.setHours(0, 0, 0, 0);

        const todayResponses = allResponses.filter((response) => {
          const responseDate = response.timestamp.toDate();
          return responseDate >= today;
        });

        statsInfo.innerHTML = `
                總回答數：${allResponses.length} 筆 | 
                今日新增：${todayResponses.length} 筆 | 
                最後更新：${new Date().toLocaleTimeString("zh-TW")}
            `;
      }

      function displayResponses(responses) {
        const container = document.getElementById("responses-container");

        if (responses.length === 0) {
          container.innerHTML =
            '<div class="no-responses">沒有符合條件的回答</div>';
          return;
        }

        let html = "";

responses.forEach((response) => {
          const timestamp = response.timestamp.toDate().toLocaleString("zh-TW");
          html += `
                    <div class="response-card">
                        <button class="delete-btn" onclick="deleteResponse('${response.id}')" title="刪除此回答">×</button>
                        <div class="response-header">${response.nickname} (${timestamp})</div>
                        <div class="response-item">
                            <div class="response-question">1. 請寫下您加入展晟前，對展晟的第一印象？</div>
                            <div class="response-answer">${response.answers.firstImpression}</div>
                        </div>
                        <div class="response-item">
                            <div class="response-question">2. 請寫下您加入展晟後，讓您印象最深刻的人或事物？</div>
                            <div class="response-answer">${response.answers.memorableExperience}</div>
                        </div>
                    </div>
                `;
        });

        container.innerHTML = html;
      }

      function refreshResponses() {
        if (currentUser) {
          loadResponses();
        }
      }

      async function clearAllResponses() {
        if (!currentUser) {
          alert("請先登入管理員帳號");
          return;
        }

        if (!confirm("確定要清除所有回答嗎？此操作無法復原。")) {
          return;
        }

        try {
          const responsesRef = collection(db, "responses");
          const querySnapshot = await getDocs(responsesRef);

          const deletePromises = [];
          querySnapshot.forEach((doc) => {
            deletePromises.push(deleteDoc(doc.ref));
          });

          await Promise.all(deletePromises);
          console.log("✅ 所有資料已清除");
          alert("所有資料已成功清除");
        } catch (error) {
          console.error("清除失敗:", error);
          alert("清除失敗，請稍後再試！\n錯誤詳情：" + error.message);
        }
      }

      // 隱藏的管理員模式入口 - 連續點擊標題3次
      let clickCount = 0;
      let clickTimer = null;

      function titleClick() {
        clickCount++;

        if (clickTimer) {
          clearTimeout(clickTimer);
        }

        if (clickCount === 3) {
          showAdmin();
          clickCount = 0;
        } else {
          clickTimer = setTimeout(() => {
            clickCount = 0;
          }, 2000);
        }
      }

      // 頁面載入時初始化
      window.addEventListener("load", function () {
        showPage("nickname-page");

        // 為標題添加點擊事件
        const titles = document.querySelectorAll("h1");
        titles.forEach((title) => {
          title.style.cursor = "pointer";
          title.addEventListener("click", titleClick);
        });

        // 檢查網路連線狀態
        updateConnectionStatus(navigator.onLine);
      });

      // 網路狀態監控
      window.addEventListener("online", () => updateConnectionStatus(true));
      window.addEventListener("offline", () => updateConnectionStatus(false));

      // 初始化時更新連線狀態
      updateConnectionStatus(navigator.onLine);
    </script>
  </body>
</html>
